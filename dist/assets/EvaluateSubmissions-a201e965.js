import{u as T,f as v,j as e,a as n,C as g,s as x,A as F,U as P,af as $,a0 as j,I as Q,$ as y}from"./index-7e43eeaa.js";import{c as p}from"./assessments-75df469f.js";import{b as q,u as D}from"./submissions-daaf532e.js";import"./quill.snow-c8657e2f.js";import{L as N}from"./index-6800dda7.js";import{T as O}from"./index-cdc86ff5.js";import{M as U}from"./index-3d906005.js";import{F as B}from"./index-8494a245.js";import{I as L}from"./index-5e1b8229.js";import{D as z}from"./index-5a52cdcf.js";import{C as w}from"./CheckCircleOutlined-8efca08c.js";import"./extendsObject-bdadc4da.js";import"./row-43cc7f0c.js";import"./index-d2f8d546.js";import"./index-b2b0373a.js";import"./useClosable-f6b9b093.js";import"./fade-e1fcf046.js";import"./useForm-872d7ca5.js";const{TextArea:A}=Q,le=()=>{const{user:u}=T(),[k,S]=v.useState(()=>{const t=p(u.id);return q().filter(o=>t.some(c=>c.id===o.assessmentId))}),[r,f]=v.useState(null),[C,h]=v.useState(!1),I=t=>{f(t),h(!0)},E=async t=>{try{const o=r.answers.filter(i=>i.isCorrect!==null).reduce((i,s)=>i+(s.isCorrect?s.points:0),0),c=t.manualAnswers.reduce((i,s)=>i+s.points,0),a=o+c,l=Math.round(a/r.maxScore*100);D(r.id,{status:"evaluated",totalScore:a,percentage:l,instructorFeedback:t.feedback,evaluatedBy:u.id,evaluatedAt:new Date().toISOString(),answers:r.answers.map((i,s)=>i.isCorrect===null?{...i,points:t.manualAnswers[s].points,feedback:t.manualAnswers[s].feedback}:i)})&&(S(i=>i.filter(s=>s.id!==r.id)),h(!1),f(null),y.success("Submission evaluated successfully!"))}catch{y.error("Failed to evaluate submission")}},M=t=>{const o=p(u.id).find(c=>c.id===t);return(o==null?void 0:o.title)||"Unknown Assessment"};return k.length===0?e("div",{className:"p-6",children:n("div",{className:"text-center py-12",children:[e(w,{className:"text-6xl text-green-500 mb-4"}),e("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"All Caught Up!"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"No pending submissions to evaluate at this time."})]})}):n("div",{className:"p-6",children:[n("div",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Evaluate Submissions"}),e("p",{className:"text-gray-600 dark:text-gray-400",children:"Review and grade student submissions"})]}),e(g,{children:e(N,{dataSource:k,renderItem:t=>e(N.Item,{actions:[e(x,{type:"primary",onClick:()=>I(t),icon:e(w,{}),children:"Evaluate"})],children:e(N.Item.Meta,{avatar:e(F,{icon:e(P,{})}),title:n("div",{className:"flex items-center space-x-2",children:[e("span",{className:"font-medium",children:t.studentName}),e(O,{color:"orange",children:"Pending Review"})]}),description:n("div",{className:"space-y-1",children:[e("div",{children:M(t.assessmentId)}),n("div",{className:"text-sm text-gray-600",children:["Submitted: ",new Date(t.submittedAt).toLocaleString()]}),n("div",{className:"text-sm text-gray-600",children:["Time taken: ",t.timeTaken?`${Math.floor(t.timeTaken/60)}h ${t.timeTaken%60}m`:"N/A"]})]})})})})}),e(U,{title:`Evaluate Submission - ${r==null?void 0:r.studentName}`,open:C,onCancel:()=>{h(!1),f(null)},width:1e3,footer:null,children:r&&e($,{initialValues:{manualAnswers:r.answers.filter(t=>t.isCorrect===null).map(()=>({points:0,feedback:""})),feedback:""},onSubmit:E,children:({values:t,setFieldValue:o,handleSubmit:c})=>e(B,{layout:"vertical",onFinish:c,children:n("div",{className:"space-y-6",children:[r.answers.filter(a=>a.isCorrect!==null).map((a,l)=>n(g,{size:"small",className:"bg-gray-50",children:[n("div",{className:"font-medium mb-2",children:["Question ",l+1," (Auto-evaluated)"]}),e("div",{className:"text-sm text-gray-600 mb-2",children:(()=>{const m=p(u.id).find(s=>s.id===r.assessmentId),i=m==null?void 0:m.questions.find(s=>s.id===a.questionId);return(i==null?void 0:i.question)||"Question not found"})()}),n("div",{className:"text-sm mb-2",children:[e("strong",{children:"Answer:"})," ",typeof a.answer=="string"?a.answer:a.answer.join(", ")]}),n("div",{className:`text-sm font-medium ${a.isCorrect?"text-green-600":"text-red-600"}`,children:[a.feedback," - ",a.points," points"]})]},l)),r.answers.filter(a=>a.isCorrect===null).map((a,l)=>{var m,i;return n(g,{size:"small",children:[n("div",{className:"font-medium mb-2",children:["Question ",r.answers.filter(s=>s.isCorrect!==null).length+l+1," (Manual Evaluation)"]}),e("div",{className:"text-sm text-gray-600 mb-2",children:(()=>{const s=p(u.id).find(b=>b.id===r.assessmentId),d=s==null?void 0:s.questions.find(b=>b.id===a.questionId);return(d==null?void 0:d.question)||"Question not found"})()}),n("div",{className:"text-sm mb-4",children:[e("strong",{children:"Student Answer:"}),e("div",{className:"mt-1 p-3 bg-gray-50 rounded border",children:a.answer})]}),n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n("div",{children:[e("label",{className:"block text-sm font-medium mb-2",children:"Points"}),e(L,{value:((m=t.manualAnswers[l])==null?void 0:m.points)||0,onChange:s=>{const d=[...t.manualAnswers];d[l]={...d[l],points:s},o("manualAnswers",d)},min:0,max:a.points,className:"w-full"}),n("div",{className:"text-xs text-gray-500 mt-1",children:["Max: ",a.points," points"]})]}),n("div",{children:[e("label",{className:"block text-sm font-medium mb-2",children:"Feedback"}),e(A,{value:((i=t.manualAnswers[l])==null?void 0:i.feedback)||"",onChange:s=>{const d=[...t.manualAnswers];d[l]={...d[l],feedback:s.target.value},o("manualAnswers",d)},rows:3,placeholder:"Provide feedback for this answer..."})]})]})]},`manual-${l}`)}),e(z,{}),n("div",{children:[e("label",{className:"block text-sm font-medium mb-2",children:"Overall Feedback"}),e(A,{value:t.feedback,onChange:a=>o("feedback",a.target.value),rows:4,placeholder:"Provide overall feedback for this submission..."})]}),e("div",{className:"flex justify-end",children:n(j,{children:[e(x,{onClick:()=>h(!1),children:"Cancel"}),e(x,{type:"primary",htmlType:"submit",children:"Submit Evaluation"})]})})]})})})})]})};export{le as default};
